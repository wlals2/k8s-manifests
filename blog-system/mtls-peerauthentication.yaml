# ==============================================================================
# PeerAuthentication (mTLS 정책)
# ==============================================================================
# 목적: Istio mesh 내부 트래픽 암호화 설정
#
# 정책:
# - namespace 기본: PERMISSIVE (Nginx Ingress 호환성 유지)
# - DestinationRule에서 ISTIO_MUTUAL 명시로 mTLS 강제
#
# 효과:
# - web → was: DestinationRule의 ISTIO_MUTUAL로 mTLS 강제
# - Ingress → web: plain text 허용 (PERMISSIVE)
# - was → mysql: plain text (mysql은 mesh 제외)
#
# 참고:
# - Commit 0b8d573: STRICT → PERMISSIVE 변경 (502 에러 해결)
# - portLevelMtls는 selector 필요 → 대신 DestinationRule로 mTLS 강제
# ==============================================================================
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
  namespace: blog-system
spec:
  mtls:
    mode: PERMISSIVE  # mTLS와 plain text 둘 다 허용 (Ingress 접근 위해 필요)
