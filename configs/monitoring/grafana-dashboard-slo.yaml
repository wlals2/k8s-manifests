# ==============================================================================
# Grafana Dashboard: SLI/SLO Monitoring
# ==============================================================================
# ëª©ì : SLI (Service Level Indicator) ë° SLO (Service Level Objective) ëª¨ë‹ˆí„°ë§
# ì—­í• : Recording Rulesë¡œ ë¯¸ë¦¬ ê³„ì‚°ëœ SLI ë©”íŠ¸ë¦­ì„ ì‹œê°í™”í•˜ì—¬ ì„œë¹„ìŠ¤ í’ˆì§ˆ ì¶”ì 
# ì˜ì¡´ì„±:
#   - sli-recording-rules.yaml: sli:availability:*, sli:latency:* ë©”íŠ¸ë¦­ í•„ìš”
#   - slo-alerts.yaml: SLO ìœ„ë°˜ ì‹œ ì•Œë¦¼ ë°œì†¡
# ì°¸ê³ : https://grafana.com/docs/grafana/latest/dashboards/
# ==============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  # ConfigMap ì´ë¦„: grafana-dashboard-slo
  # What: Grafana Dashboardë¥¼ ì €ì¥í•˜ëŠ” ConfigMap
  # Why: Grafana provisioning ë°©ì‹ìœ¼ë¡œ ìë™ ë¡œë“œ
  # Impact: ë³€ê²½ ì‹œ Grafana Pod ì¬ì‹œì‘ í•„ìš”
  name: grafana-dashboard-slo

  # Namespace: monitoring
  # What: Grafanaì™€ ê°™ì€ namespaceì— ë°°í¬
  # Why: Grafanaê°€ ê°™ì€ namespaceì˜ ConfigMapë§Œ ì½ìŒ
  namespace: monitoring

  labels:
    # CRITICAL: Grafanaê°€ ì´ Dashboardë¥¼ ì¸ì‹í•˜ë ¤ë©´ ë¼ë²¨ í•„ìˆ˜!
    # What: grafana_dashboard ë¼ë²¨
    # Why: Grafana provisioningì´ ì´ ë¼ë²¨ì„ ê°€ì§„ ConfigMapë§Œ Dashboardë¡œ ë¡œë“œ
    # Impact: ì´ ë¼ë²¨ì´ ì—†ìœ¼ë©´ Dashboardê°€ Grafanaì— ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŒ
    grafana_dashboard: "1"

data:
  # Dashboard JSON
  # What: Grafana Dashboard ì •ì˜ (JSON í˜•ì‹)
  # Why: Grafanaê°€ ì´ JSONì„ íŒŒì‹±í•˜ì—¬ Dashboard ìƒì„±
  slo-dashboard.json: |
    {
      "dashboard": {
        "title": "ğŸ“Š SLI/SLO Monitoring",
        "tags": ["slo", "sli", "blog-system"],
        "timezone": "browser",
        "schemaVersion": 16,
        "version": 1,
        "refresh": "30s",

        "panels": [
          {
            "id": 1,
            "type": "stat",
            "title": "ğŸ¯ 30ì¼ ê°€ìš©ì„± (SLO: 99%)",
            "gridPos": { "x": 0, "y": 0, "w": 6, "h": 4 },
            "targets": [
              {
                "expr": "sli:availability:30d * 100",
                "legendFormat": "Availability",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "decimals": 3,
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    { "value": 0, "color": "red" },
                    { "value": 99, "color": "green" }
                  ]
                },
                "mappings": []
              }
            },
            "options": {
              "reduceOptions": {
                "values": false,
                "calcs": ["lastNotNull"]
              },
              "orientation": "auto",
              "textMode": "value_and_name",
              "colorMode": "value",
              "graphMode": "area"
            }
          },

          {
            "id": 2,
            "type": "stat",
            "title": "âš¡ 5ë¶„ í‰ê·  ì‘ë‹µ ì‹œê°„ (SLO: < 500ms)",
            "gridPos": { "x": 6, "y": 0, "w": 6, "h": 4 },
            "targets": [
              {
                "expr": "sli:latency:5m * 1000",
                "legendFormat": "Latency",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "ms",
                "decimals": 0,
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    { "value": 0, "color": "green" },
                    { "value": 500, "color": "red" }
                  ]
                },
                "mappings": []
              }
            },
            "options": {
              "reduceOptions": {
                "values": false,
                "calcs": ["lastNotNull"]
              },
              "orientation": "auto",
              "textMode": "value_and_name",
              "colorMode": "value",
              "graphMode": "area"
            }
          },

          {
            "id": 3,
            "type": "stat",
            "title": "ğŸ“… Error Budget (30ì¼)",
            "gridPos": { "x": 12, "y": 0, "w": 6, "h": 4 },
            "targets": [
              {
                "expr": "(1 - sli:availability:30d) * 30 * 24",
                "legendFormat": "Downtime (hours)",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "h",
                "decimals": 2,
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    { "value": 0, "color": "green" },
                    { "value": 7.2, "color": "red" }
                  ]
                },
                "mappings": []
              }
            },
            "options": {
              "reduceOptions": {
                "values": false,
                "calcs": ["lastNotNull"]
              },
              "orientation": "auto",
              "textMode": "value_and_name",
              "colorMode": "value"
            },
            "description": "í—ˆìš© ë‹¤ìš´íƒ€ì„: 7.2ì‹œê°„/30ì¼ (1% = 30ì¼ * 24ì‹œê°„ * 0.01)"
          },

          {
            "id": 4,
            "type": "stat",
            "title": "âœ… SLO ë‹¬ì„± ìƒíƒœ",
            "gridPos": { "x": 18, "y": 0, "w": 6, "h": 4 },
            "targets": [
              {
                "expr": "(sli:availability:30d >= 0.99) and (sli:latency:5m < 0.5)",
                "legendFormat": "SLO Status",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "none",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    { "value": 0, "color": "red" },
                    { "value": 1, "color": "green" }
                  ]
                },
                "mappings": [
                  { "type": "value", "value": "1", "text": "âœ… ë‹¬ì„±" },
                  { "type": "value", "value": "0", "text": "âŒ ìœ„ë°˜" }
                ]
              }
            },
            "options": {
              "reduceOptions": {
                "values": false,
                "calcs": ["lastNotNull"]
              },
              "orientation": "auto",
              "textMode": "value",
              "colorMode": "background"
            }
          },

          {
            "id": 5,
            "type": "graph",
            "title": "ğŸ“ˆ Availability Trend",
            "gridPos": { "x": 0, "y": 4, "w": 12, "h": 8 },
            "targets": [
              {
                "expr": "sli:availability:1m * 100",
                "legendFormat": "1ë¶„ í‰ê· ",
                "refId": "A"
              },
              {
                "expr": "sli:availability:5m * 100",
                "legendFormat": "5ë¶„ í‰ê· ",
                "refId": "B"
              },
              {
                "expr": "sli:availability:1h * 100",
                "legendFormat": "1ì‹œê°„ í‰ê· ",
                "refId": "C"
              }
            ],
            "yaxes": [
              {
                "format": "percent",
                "min": 95,
                "max": 100,
                "decimals": 2
              },
              {
                "format": "short"
              }
            ],
            "xaxis": {
              "mode": "time"
            },
            "lines": true,
            "fill": 1,
            "linewidth": 2,
            "points": false,
            "bars": false,
            "stack": false,
            "percentage": false,
            "legend": {
              "show": true,
              "values": true,
              "current": true,
              "avg": true
            },
            "thresholds": [
              {
                "value": 99,
                "colorMode": "critical",
                "op": "lt",
                "fill": true,
                "line": true
              }
            ]
          },

          {
            "id": 6,
            "type": "graph",
            "title": "âš¡ Latency Trend",
            "gridPos": { "x": 12, "y": 4, "w": 12, "h": 8 },
            "targets": [
              {
                "expr": "sli:latency:1m * 1000",
                "legendFormat": "1ë¶„ í‰ê· ",
                "refId": "A"
              },
              {
                "expr": "sli:latency:5m * 1000",
                "legendFormat": "5ë¶„ í‰ê· ",
                "refId": "B"
              }
            ],
            "yaxes": [
              {
                "format": "ms",
                "min": 0,
                "decimals": 0
              },
              {
                "format": "short"
              }
            ],
            "xaxis": {
              "mode": "time"
            },
            "lines": true,
            "fill": 1,
            "linewidth": 2,
            "points": false,
            "bars": false,
            "stack": false,
            "percentage": false,
            "legend": {
              "show": true,
              "values": true,
              "current": true,
              "avg": true,
              "max": true
            },
            "thresholds": [
              {
                "value": 500,
                "colorMode": "critical",
                "op": "gt",
                "fill": true,
                "line": true
              }
            ]
          },

          {
            "id": 7,
            "type": "table",
            "title": "ğŸ“Š SLI Summary",
            "gridPos": { "x": 0, "y": 12, "w": 12, "h": 6 },
            "targets": [
              {
                "expr": "sli:availability:1m * 100",
                "format": "table",
                "instant": true,
                "legendFormat": "",
                "refId": "A"
              },
              {
                "expr": "sli:availability:5m * 100",
                "format": "table",
                "instant": true,
                "refId": "B"
              },
              {
                "expr": "sli:availability:1h * 100",
                "format": "table",
                "instant": true,
                "refId": "C"
              },
              {
                "expr": "sli:availability:30d * 100",
                "format": "table",
                "instant": true,
                "refId": "D"
              }
            ],
            "styles": [
              {
                "pattern": "Time",
                "type": "hidden"
              },
              {
                "pattern": "Value",
                "type": "number",
                "unit": "percent",
                "decimals": 3,
                "thresholds": ["99"],
                "colorMode": "cell",
                "colors": ["red", "green"]
              }
            ],
            "transform": "timeseries_aggregations"
          },

          {
            "id": 8,
            "type": "table",
            "title": "âš¡ Latency Summary",
            "gridPos": { "x": 12, "y": 12, "w": 12, "h": 6 },
            "targets": [
              {
                "expr": "sli:latency:1m * 1000",
                "format": "table",
                "instant": true,
                "legendFormat": "",
                "refId": "A"
              },
              {
                "expr": "sli:latency:5m * 1000",
                "format": "table",
                "instant": true,
                "refId": "B"
              }
            ],
            "styles": [
              {
                "pattern": "Time",
                "type": "hidden"
              },
              {
                "pattern": "Value",
                "type": "number",
                "unit": "ms",
                "decimals": 0,
                "thresholds": ["500"],
                "colorMode": "cell",
                "colors": ["green", "red"]
              }
            ],
            "transform": "timeseries_aggregations"
          }
        ]
      }
    }
