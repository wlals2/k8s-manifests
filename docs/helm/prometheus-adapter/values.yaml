# Prometheus Adapter Custom Values
# 기본값 외 변경사항만 기록

# Prometheus 연결
prometheus:
  url: http://prometheus.monitoring.svc.cluster.local
  port: 9090

# 리소스
replicas: 1
resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    cpu: 200m
    memory: 256Mi

# Pod Anti-Affinity
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - prometheus-adapter
          topologyKey: kubernetes.io/hostname

# Custom Metrics Rules
rules:
  default: false
  custom:
    # Container Network Receive Rate (HPA용)
    - seriesQuery: 'container_network_receive_bytes_total{namespace="blog-system",pod=~"web.*",interface="eth0"}'
      resources:
        overrides:
          namespace:
            resource: namespace
          pod:
            resource: pod
      name:
        matches: "^(.*)_total$"
        as: "${1}_per_second"
      metricsQuery: |
        sum(rate(<<.Series>>{<<.LabelMatchers>>,interface="eth0"}[1m])) by (<<.GroupBy>>)

    # Container Network Transmit Rate
    - seriesQuery: 'container_network_transmit_bytes_total{namespace="blog-system",pod=~"web.*",interface="eth0"}'
      resources:
        overrides:
          namespace:
            resource: namespace
          pod:
            resource: pod
      name:
        matches: "^(.*)_total$"
        as: "${1}_per_second"
      metricsQuery: |
        sum(rate(<<.Series>>{<<.LabelMatchers>>,interface="eth0"}[1m])) by (<<.GroupBy>>)
