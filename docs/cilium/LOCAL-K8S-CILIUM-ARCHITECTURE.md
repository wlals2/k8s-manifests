# ë¡œì»¬ K8s í´ëŸ¬ìŠ¤í„° + Cilium CNI ì•„í‚¤í…ì²˜

> **ì‘ì„±ì¼**: 2026-01-12
> **í´ëŸ¬ìŠ¤í„° ì´ë¦„**: local-k8s
> **K8s ë²„ì „**: v1.31.13
> **Cilium ë²„ì „**: v1.18.4

---

## ğŸ“Š í˜„ì¬ ìƒíƒœ ìš”ì•½

### í´ëŸ¬ìŠ¤í„° êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     local-k8s Cluster                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   k8s-cp     â”‚   â”‚ k8s-worker1  â”‚   â”‚ k8s-worker2  â”‚   â”‚
â”‚  â”‚              â”‚   â”‚              â”‚   â”‚              â”‚   â”‚
â”‚  â”‚  âœ… Ready     â”‚   â”‚ âŒ NotReady   â”‚   â”‚ âŒ NotReady   â”‚   â”‚
â”‚  â”‚              â”‚   â”‚              â”‚   â”‚              â”‚   â”‚
â”‚  â”‚ Control      â”‚   â”‚ Worker Node  â”‚   â”‚ Worker Node  â”‚   â”‚
â”‚  â”‚ Plane        â”‚   â”‚              â”‚   â”‚              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   192.168.1.187      192.168.1.61       192.168.1.62      â”‚
â”‚                                                             â”‚
â”‚  CNI: Cilium v1.18.4 (DaemonSet on all nodes)             â”‚
â”‚  Container Runtime: containerd 2.1.5                        â”‚
â”‚  OS: Ubuntu 22.04.5 LTS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë…¸ë“œ ìƒíƒœ

| ë…¸ë“œ | ì—­í•  | ìƒíƒœ | IP | ì´ìœ  |
|------|------|------|----|------|
| **k8s-cp** | Control Plane | âœ… Ready | 192.168.1.187 | ì •ìƒ |
| **k8s-worker1** | Worker | âŒ NotReady | 192.168.1.61 | Kubelet stopped |
| **k8s-worker2** | Worker | âŒ NotReady | 192.168.1.62 | Kubelet stopped |

**ë¬¸ì œ**: Worker ë…¸ë“œë“¤ì´ 4ì¼ 21ì‹œê°„ ì „ë¶€í„° ì—°ê²° ëŠê¹€ (ë¬¼ë¦¬ì  ë‹¤ìš´ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ)

---

## ğŸŒ Cilium CNI ì•„í‚¤í…ì²˜

### 1. Ciliumì´ë€?

**Cilium**ì€ eBPF ê¸°ë°˜ì˜ Kubernetes CNI (Container Network Interface) í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.

**í•µì‹¬ íŠ¹ì§•**:
- âœ… Linux Kernel eBPF ê¸°ìˆ  ì‚¬ìš©
- âœ… L3/L4/L7 ë„¤íŠ¸ì›Œí¬ ì •ì±… ì§€ì›
- âœ… Service Mesh ê¸°ëŠ¥ (Envoy í†µí•©)
- âœ… ê´€ì¸¡ì„± (Hubble)
- âœ… ê³ ì„±ëŠ¥ ë„¤íŠ¸ì›Œí‚¹

---

### 2. í˜„ì¬ Cilium ì„¤ì •

**í´ëŸ¬ìŠ¤í„°ì— ì ìš©ëœ Cilium êµ¬ì„±**:

| ì„¤ì • í•­ëª© | ê°’ | ì„¤ëª… |
|----------|-----|------|
| **Cilium ë²„ì „** | v1.18.4 | 2024ë…„ ë¦´ë¦¬ìŠ¤ |
| **Datapath Mode** | veth | ê°€ìƒ Ethernet í˜ì–´ ì‚¬ìš© |
| **Routing Mode** | tunnel | VXLAN í„°ë„ ì‚¬ìš© |
| **Tunnel Protocol** | VXLAN | Overlay ë„¤íŠ¸ì›Œí¬ |
| **IPAM Mode** | cluster-pool | Ciliumì´ IP í• ë‹¹ ê´€ë¦¬ |
| **Pod CIDR** | 10.0.0.0/8 | Pod IP ëŒ€ì—­ |
| **IPv4** | Enabled | IPv4 ë„¤íŠ¸ì›Œí‚¹ í™œì„±í™” |
| **IPv6** | Disabled | IPv6 ë¹„í™œì„±í™” |
| **Hubble** | Enabled (ConfigMap) | ê´€ì¸¡ì„± ê¸°ëŠ¥ í™œì„±í™” |
| **kube-proxy ëŒ€ì²´** | Disabled | kube-proxy í•¨ê»˜ ì‚¬ìš© |
| **Masquerade** | Enabled | NAT í™œì„±í™” |

---

### 3. Cilium ì»´í¬ë„ŒíŠ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Cilium Architecture                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Cilium Agent (DaemonSet)                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚  â”‚ k8s-cp  â”‚  â”‚worker1  â”‚  â”‚worker2  â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ Running â”‚  â”‚ Running â”‚  â”‚ Running â”‚             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â”‚   ê° ë…¸ë“œì—ì„œ eBPF í”„ë¡œê·¸ë¨ ë¡œë“œ ë° ë„¤íŠ¸ì›Œí¬ ì •ì±… ì ìš©  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Cilium Envoy (DaemonSet)                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚  â”‚ k8s-cp  â”‚  â”‚worker1  â”‚  â”‚worker2  â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ Running â”‚  â”‚ Running â”‚  â”‚ Running â”‚             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â”‚   L7 í”„ë¡ì‹œ (HTTP, gRPC ë“± L7 ì •ì±…)                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        Cilium Operator (Deployment)                  â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚   â”‚
â”‚  â”‚              â”‚ k8s-cp  â”‚                             â”‚   â”‚
â”‚  â”‚              â”‚ Running â”‚                             â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚   â”‚
â”‚  â”‚   í´ëŸ¬ìŠ¤í„° ì „ì²´ ì‘ì—… (IPAM, CRD ê´€ë¦¬ ë“±)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.1 Cilium Agent

**ì—­í• **: ê° ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” í•µì‹¬ ì»´í¬ë„ŒíŠ¸

**ê¸°ëŠ¥**:
- eBPF í”„ë¡œê·¸ë¨ì„ ì»¤ë„ì— ë¡œë“œ
- ë„¤íŠ¸ì›Œí¬ ì •ì±… ì ìš©
- Pod ê°„ ë¼ìš°íŒ… ì²˜ë¦¬
- Service Load Balancing
- ë„¤íŠ¸ì›Œí¬ ê´€ì¸¡

**í˜„ì¬ ìƒíƒœ**:
- k8s-cp: cilium-ksv4c (Running)
- k8s-worker1: cilium-hgrr8 (Running, ë…¸ë“œ ë‹¤ìš´)
- k8s-worker2: cilium-kks8n (Running, ë…¸ë“œ ë‹¤ìš´)

---

#### 3.2 Cilium Envoy

**ì—­í• **: L7 í”„ë¡ì‹œ (HTTP, gRPC, Kafka ë“±)

**ê¸°ëŠ¥**:
- L7 ë„¤íŠ¸ì›Œí¬ ì •ì±… ì ìš©
- HTTP/gRPC íŠ¸ë˜í”½ ì œì–´
- ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- Service Mesh ê¸°ëŠ¥

**í˜„ì¬ ìƒíƒœ**:
- k8s-cp: cilium-envoy-fqvdw (Running)
- k8s-worker1: cilium-envoy-ls4jt (Running, ë…¸ë“œ ë‹¤ìš´)
- k8s-worker2: cilium-envoy-tvg9h (Running, ë…¸ë“œ ë‹¤ìš´)

---

#### 3.3 Cilium Operator

**ì—­í• **: í´ëŸ¬ìŠ¤í„° ë ˆë²¨ ì‘ì—… ìˆ˜í–‰

**ê¸°ëŠ¥**:
- IPAM (IP Address Management)
- CiliumNode, CiliumEndpoint CRD ê´€ë¦¬
- K8s API í†µí•©
- Garbage Collection

**í˜„ì¬ ìƒíƒœ**:
- 1ê°œ Running (k8s-cp)
- 1ê°œ Pending (k8s-worker2 - ë…¸ë“œ ë‹¤ìš´ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ ë¶ˆê°€)
- 1ê°œ Terminating (k8s-worker1 - ë…¸ë“œ ë‹¤ìš´ìœ¼ë¡œ ì¢…ë£Œ ì¤‘)

---

### 4. Cilium ë„¤íŠ¸ì›Œí¬ ë™ì‘ ì›ë¦¬

#### 4.1 Pod ê°„ í†µì‹  (VXLAN Tunnel Mode)

```
Pod A (10.0.0.10)                         Pod B (10.0.2.20)
   â”‚                                          â”‚
   â”‚ k8s-cp                                   â”‚ k8s-worker1
   â”‚                                          â”‚
   â”œâ”€â–º Cilium Agent (eBPF)                   â”‚
   â”‚   â”œâ”€ íŒ¨í‚· ìº¡ì²˜                           â”‚
   â”‚   â”œâ”€ ì •ì±… ê²€ì‚¬                           â”‚
   â”‚   â””â”€ VXLAN ìº¡ìŠí™”                        â”‚
   â”‚                                          â”‚
   â””â”€â”€â”€â–º VXLAN Tunnel (UDP 8472) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–º Cilium Agent (eBPF)
       (ì™¸ë¶€ IP: 192.168.1.187)               â”‚   â”œâ”€ VXLAN ì—­ìº¡ìŠí™”
        â†’ (ì™¸ë¶€ IP: 192.168.1.61)             â”‚   â”œâ”€ ì •ì±… ê²€ì‚¬
                                              â”‚   â””â”€ Pod Bë¡œ ì „ë‹¬
                                              â”‚
                                              â””â”€â–º Pod B
```

**VXLAN í„°ë„**:
- Overlay ë„¤íŠ¸ì›Œí¬ êµ¬ì„±
- Pod CIDR (10.0.0.0/8)ê³¼ ë…¸ë“œ IP (192.168.1.x) ë¶„ë¦¬
- UDP 8472 í¬íŠ¸ ì‚¬ìš©
- í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ ë³€ê²½ ì—†ì´ Pod ë„¤íŠ¸ì›Œí‚¹ ê°€ëŠ¥

---

#### 4.2 Service Load Balancing

```
External Request â†’ NodePort 30080
                        â”‚
                        â”œâ”€â–º kube-proxy (iptables)
                        â”‚   ë˜ëŠ”
                        â””â”€â–º Cilium eBPF (kube-proxy ëŒ€ì²´ ì‹œ)
                            â”‚
                            â”œâ”€â–º Pod A (10.0.0.10)
                            â”œâ”€â–º Pod B (10.0.2.20)
                            â””â”€â–º Pod C (10.0.2.30)
```

**í˜„ì¬ ì„¤ì •**: kube-proxy ì‚¬ìš© (kube-proxy-replacement: false)

**Ciliumì´ kube-proxyë¥¼ ëŒ€ì²´í•  ê²½ìš°**:
- eBPF ê¸°ë°˜ ë¡œë“œë°¸ëŸ°ì‹± (iptables ê·œì¹™ ì—†ìŒ)
- ë” ë¹ ë¥¸ ì„±ëŠ¥
- DSR (Direct Server Return) ì§€ì›

---

#### 4.3 L7 ë„¤íŠ¸ì›Œí¬ ì •ì±… (Envoy)

```
Pod A â”€â–º HTTP Request (GET /api/users)
         â”‚
         â”œâ”€â–º Cilium Envoy Proxy
         â”‚   â”œâ”€ L7 ì •ì±… ê²€ì‚¬
         â”‚   â”‚  - HTTP Method ì²´í¬
         â”‚   â”‚  - Path ì²´í¬
         â”‚   â”‚  - Header ì²´í¬
         â”‚   â””â”€ í—ˆìš©/ê±°ë¶€ ê²°ì •
         â”‚
         â””â”€â–º Pod B (í—ˆìš© ì‹œ)
```

**ì˜ˆì‹œ L7 ì •ì±…**:
```yaml
apiVersion: cilium.io/v2
kind: CiliumNetworkPolicy
metadata:
  name: allow-get-only
spec:
  endpointSelector:
    matchLabels:
      app: api-server
  ingress:
    - fromEndpoints:
        - matchLabels:
            app: frontend
      toPorts:
        - ports:
            - port: "80"
              protocol: TCP
          rules:
            http:
              - method: GET
                path: "/api/.*"
```

---

## âœ¨ Ciliumì˜ ì£¼ìš” ì¥ì 

### 1. eBPF ê¸°ë°˜ ê³ ì„±ëŠ¥

**ê¸°ì¡´ CNI (Calico, Flannel ë“±)**:
```
íŒ¨í‚· íë¦„: Pod â†’ iptables â†’ routing â†’ iptables â†’ Pod
           (ì»¤ë„ <-> ìœ ì €ìŠ¤í˜ì´ìŠ¤ ì „í™˜ ë¹ˆë²ˆ)
```

**Cilium eBPF**:
```
íŒ¨í‚· íë¦„: Pod â†’ eBPF (ì»¤ë„ ë‚´ë¶€) â†’ Pod
           (ìœ ì €ìŠ¤í˜ì´ìŠ¤ ì „í™˜ ìµœì†Œí™”)
```

**ì„±ëŠ¥ ì´ì **:
- âœ… 30-40% ë” ë¹ ë¥¸ ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬
- âœ… CPU ì‚¬ìš©ëŸ‰ ê°ì†Œ
- âœ… Latency ê°ì†Œ

---

### 2. L7 ë„¤íŠ¸ì›Œí¬ ì •ì±… ì§€ì›

**ê¸°ì¡´ CNI**:
- L3 (IP), L4 (Port)ê¹Œì§€ë§Œ ì •ì±… ì ìš© ê°€ëŠ¥

**Cilium**:
- âœ… L7 (HTTP, gRPC, Kafka, DNS) ì •ì±… ì ìš©
- âœ… REST API ì—”ë“œí¬ì¸íŠ¸ë³„ ì ‘ê·¼ ì œì–´
- âœ… HTTP Method ê¸°ë°˜ ì •ì±…

**ì˜ˆì‹œ**:
```yaml
# "GET /api/users"ë§Œ í—ˆìš©, "POST /api/users"ëŠ” ì°¨ë‹¨
http:
  - method: GET
    path: "/api/users"
```

---

### 3. Hubble ê´€ì¸¡ì„±

**Hubble**: Cilium ë‚´ì¥ ë„¤íŠ¸ì›Œí¬ ê´€ì¸¡ì„± ë„êµ¬

**ê¸°ëŠ¥**:
- âœ… ì‹¤ì‹œê°„ ë„¤íŠ¸ì›Œí¬ í”Œë¡œìš° ì‹œê°í™”
- âœ… Service Dependency Map
- âœ… ë„¤íŠ¸ì›Œí¬ ì •ì±… ê²€ì¦
- âœ… íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

**Hubble UI**:
```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Hubble UI   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Hubble Relay â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ Cilium  â”‚      â”‚ Cilium  â”‚     â”‚ Cilium  â”‚
   â”‚ Agent   â”‚      â”‚ Agent   â”‚     â”‚ Agent   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     k8s-cp          worker1          worker2
```

**í˜„ì¬ ìƒíƒœ**: ConfigMapì—ì„œ enable-hubble: true ì„¤ì •ë˜ì—ˆì§€ë§Œ, Hubble Relay/UIëŠ” ë¯¸ë°°í¬

---

### 4. Service Mesh ê¸°ëŠ¥ (Sidecar-less)

**ì „í†µì  Service Mesh (Istio)**:
```
Pod:
â”œâ”€ App Container
â””â”€ Envoy Sidecar (ë¦¬ì†ŒìŠ¤ ì˜¤ë²„í—¤ë“œ)
```

**Cilium Service Mesh**:
```
Pod:
â””â”€ App Containerë§Œ
   (Cilium EnvoyëŠ” ë…¸ë“œ ë ˆë²¨ì—ì„œ ê³µìœ )
```

**ì´ì **:
- âœ… Sidecar ì—†ìŒ (ë©”ëª¨ë¦¬/CPU ì ˆì•½)
- âœ… L7 íŠ¸ë˜í”½ ì œì–´ ê°€ëŠ¥
- âœ… mTLS (ìƒí˜¸ TLS) ì§€ì›
- âœ… Observability

---

### 5. Multi-Cluster Networking (ClusterMesh)

**ClusterMesh**: ì—¬ëŸ¬ K8s í´ëŸ¬ìŠ¤í„° ê°„ ë„¤íŠ¸ì›Œí‚¹

**ê¸°ëŠ¥**:
- âœ… í´ëŸ¬ìŠ¤í„° ê°„ Pod í†µì‹ 
- âœ… í´ëŸ¬ìŠ¤í„° ê°„ Service ê³µìœ 
- âœ… Multi-Cloud (AWS + Azure ë“±)
- âœ… DR (Disaster Recovery) ì‹œë‚˜ë¦¬ì˜¤

---

### 6. ë³´ì•ˆ ê°•í™”

**Identity-based Security**:
- ê° Podì— ê³ ìœ  Identity í• ë‹¹
- IPê°€ ì•„ë‹Œ Identity ê¸°ë°˜ ì •ì±… ì ìš©
- IP ë³€ê²½ ì‹œì—ë„ ì •ì±… ìœ ì§€

**NetworkPolicy ì˜ˆì‹œ**:
```yaml
apiVersion: cilium.io/v2
kind: CiliumNetworkPolicy
metadata:
  name: api-security
spec:
  endpointSelector:
    matchLabels:
      app: api-server
  ingress:
    - fromEndpoints:
        - matchLabels:
            app: frontend
```

---

## ğŸ“Š Cilium vs ë‹¤ë¥¸ CNI ë¹„êµ

| ê¸°ëŠ¥ | Cilium | Calico | Flannel | Weave |
|------|--------|--------|---------|-------|
| **eBPF** | âœ… | âŒ | âŒ | âŒ |
| **L7 ì •ì±…** | âœ… | âŒ | âŒ | âŒ |
| **Hubble (ê´€ì¸¡ì„±)** | âœ… | âŒ | âŒ | âŒ |
| **Service Mesh** | âœ… | âŒ | âŒ | âŒ |
| **ClusterMesh** | âœ… | âŒ | âŒ | âŒ |
| **kube-proxy ëŒ€ì²´** | âœ… | âœ… | âŒ | âŒ |
| **BGP ë¼ìš°íŒ…** | âœ… | âœ… | âŒ | âŒ |
| **Overlay (VXLAN)** | âœ… | âœ… | âœ… | âœ… |
| **ì„±ëŠ¥** | ğŸ”¥ ë§¤ìš° ë†’ìŒ | ë†’ìŒ | ë³´í†µ | ë³´í†µ |
| **ë³µì¡ë„** | ë†’ìŒ | ì¤‘ê°„ | ë‚®ìŒ | ë‚®ìŒ |

---

## ğŸ” í˜„ì¬ í´ëŸ¬ìŠ¤í„° ë¬¸ì œ ì§„ë‹¨

### ë¬¸ì œ: Worker ë…¸ë“œ NotReady

**ì¦ìƒ**:
- k8s-worker1, k8s-worker2ê°€ 4ì¼ 21ì‹œê°„ ë™ì•ˆ NotReady
- Kubelet stopped posting node status

**ì›ì¸ (ì¶”ì •)**:
1. ë¬¼ë¦¬ì  ë…¸ë“œ ë‹¤ìš´ (ì „ì› êº¼ì§, ì¬ë¶€íŒ…)
2. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ëŠê¹€ (ìŠ¤ìœ„ì¹˜, ë¼ìš°í„° ë¬¸ì œ)
3. Kubelet ì„œë¹„ìŠ¤ ì¤‘ì§€

**Cilium ìƒíƒœ**:
- âœ… Cilium AgentëŠ” ì •ìƒ (NetworkUnavailable: False)
- âœ… ë„¤íŠ¸ì›Œí¬ ìì²´ëŠ” ë¬¸ì œì—†ìŒ
- âŒ ë…¸ë“œ ìì²´ê°€ ì ‘ê·¼ ë¶ˆê°€

**í•´ê²° ë°©ë²•**:
```bash
# 1. Worker ë…¸ë“œ ë¬¼ë¦¬ì  ì ‘ê·¼
ssh 192.168.1.61  # k8s-worker1
ssh 192.168.1.62  # k8s-worker2

# 2. Kubelet ì„œë¹„ìŠ¤ í™•ì¸
sudo systemctl status kubelet

# 3. Kubelet ì¬ì‹œì‘ (í•„ìš” ì‹œ)
sudo systemctl restart kubelet

# 4. ë…¸ë“œ ì¬ë¶€íŒ… (ìµœí›„ì˜ ìˆ˜ë‹¨)
sudo reboot
```

---

## ğŸš€ ì¶”ì²œ ê°œì„  ì‚¬í•­

### 1. Hubble ì„¤ì¹˜ (ê´€ì¸¡ì„± ê°•í™”)

```bash
# Hubble Relay ì„¤ì¹˜
kubectl apply -f https://raw.githubusercontent.com/cilium/cilium/v1.18.4/install/kubernetes/quick-hubble-install.yaml

# Hubble UI ì„¤ì¹˜
helm upgrade cilium cilium/cilium --version 1.18.4 \
  --namespace kube-system \
  --set hubble.relay.enabled=true \
  --set hubble.ui.enabled=true
```

**íš¨ê³¼**:
- ë„¤íŠ¸ì›Œí¬ í”Œë¡œìš° ì‹¤ì‹œê°„ ì‹œê°í™”
- Service Dependency Map
- íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ìš©ì´

---

### 2. kube-proxy ëŒ€ì²´ í™œì„±í™”

```bash
helm upgrade cilium cilium/cilium --version 1.18.4 \
  --namespace kube-system \
  --set kubeProxyReplacement=true
```

**íš¨ê³¼**:
- iptables ê·œì¹™ ì œê±° (eBPFë¡œ ëŒ€ì²´)
- 30-40% ì„±ëŠ¥ í–¥ìƒ
- DSR (Direct Server Return) ì§€ì›

---

### 3. Native Routing ëª¨ë“œ (VXLAN â†’ Native)

**í˜„ì¬**: Tunnel Mode (VXLAN)
**ì¶”ì²œ**: Native Routing Mode

```bash
helm upgrade cilium cilium/cilium --version 1.18.4 \
  --namespace kube-system \
  --set tunnel=disabled \
  --set autoDirectNodeRoutes=true
```

**ì¡°ê±´**:
- ëª¨ë“  ë…¸ë“œê°€ ê°™ì€ L2 ë„¤íŠ¸ì›Œí¬ì— ìˆì–´ì•¼ í•¨
- ë¼ìš°í„°ê°€ Pod CIDR ë¼ìš°íŒ…ì„ ì§€ì›í•´ì•¼ í•¨

**íš¨ê³¼**:
- VXLAN ìº¡ìŠí™” ì˜¤ë²„í—¤ë“œ ì œê±°
- ë” ë¹ ë¥¸ ì„±ëŠ¥

---

### 4. NetworkPolicy ì ìš©

```yaml
apiVersion: cilium.io/v2
kind: CiliumNetworkPolicy
metadata:
  name: frontend-backend-policy
  namespace: default
spec:
  endpointSelector:
    matchLabels:
      app: backend
  ingress:
    - fromEndpoints:
        - matchLabels:
            app: frontend
      toPorts:
        - ports:
            - port: "8080"
              protocol: TCP
          rules:
            http:
              - method: GET
                path: "/api/.*"
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

| ë¦¬ì†ŒìŠ¤ | URL |
|--------|-----|
| **Cilium ê³µì‹ ë¬¸ì„œ** | https://docs.cilium.io/ |
| **Cilium GitHub** | https://github.com/cilium/cilium |
| **eBPF ì†Œê°œ** | https://ebpf.io/ |
| **Hubble ë¬¸ì„œ** | https://docs.cilium.io/en/stable/gettingstarted/hubble/ |
| **ClusterMesh** | https://docs.cilium.io/en/stable/gettingstarted/clustermesh/ |

---

## ğŸ“Š ë¡œì»¬ í´ëŸ¬ìŠ¤í„° ìš”ì•½

| í•­ëª© | ê°’ |
|------|-----|
| **í´ëŸ¬ìŠ¤í„° ì´ë¦„** | local-k8s |
| **K8s ë²„ì „** | v1.31.13 |
| **ë…¸ë“œ ìˆ˜** | 3ê°œ (1 CP, 2 Worker) |
| **ì •ìƒ ë…¸ë“œ** | 1ê°œ (k8s-cp) |
| **CNI** | Cilium v1.18.4 |
| **Datapath** | veth |
| **Routing** | VXLAN Tunnel |
| **Pod CIDR** | 10.0.0.0/8 |
| **Service CIDR** | (ë¯¸í™•ì¸) |
| **kube-proxy** | ì‚¬ìš© ì¤‘ |
| **Hubble** | ì„¤ì •ë¨ (ë¯¸ë°°í¬) |

---

**ì‘ì„±ì¼**: 2026-01-12
**ë²„ì „**: 1.0
