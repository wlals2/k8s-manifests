# ==============================================================================
# Kube-Prometheus-Stack Values
# ==============================================================================
# ëª©ì : Raw ConfigMap ëŒ€ì‹  CRD ê¸°ë°˜ ëª¨ë‹ˆí„°ë§ êµ¬í˜„
# ë³€ê²½ ì´ìœ : ConfigMapì€ runtime ìˆ˜ì •ìœ¼ë¡œ OutOfSync ì§€ì† ë°œìƒ
# í•´ê²°ì±…: ServiceMonitor/PrometheusRule CRD ì‚¬ìš© â†’ Always Synced
# ==============================================================================
# CRITICAL: Wrapper Chartì—ì„œëŠ” dependency nameì„ prefixë¡œ ì‚¬ìš©í•´ì•¼ í•¨!
# Chart.yamlì˜ dependencies.name: kube-prometheus-stack
# ==============================================================================

kube-prometheus-stack:
  # ==============================================================================
  # Global Settings
  # ==============================================================================
  global:
    # RBAC: Role-Based Access Control í™œì„±í™”
    # ì´ìœ : Prometheus Operatorê°€ CRDë¥¼ ê´€ë¦¬í•˜ë ¤ë©´ RBAC í•„ìš”
    # ì˜í–¥: ServiceAccount, ClusterRole, ClusterRoleBinding ìë™ ìƒì„±
    rbac:
      create: true

  # ==============================================================================
  # Prometheus Operator
  # ==============================================================================
  # ì—­í• : ServiceMonitor/PrometheusRule CRDë¥¼ ê°ì‹œí•˜ê³  Prometheus ì„¤ì • ìë™ ì—…ë°ì´íŠ¸
  # ì‘ë™ ì›ë¦¬:
  #   1. ServiceMonitor CRD ìƒì„± â†’ Operatorê°€ ê°ì§€
  #   2. Operatorê°€ prometheus.ymlì— scrape_configs ìë™ ì¶”ê°€
  #   3. Prometheus Pod ìë™ reload (ConfigMap ìˆ˜ë™ ìˆ˜ì • ë¶ˆí•„ìš”!)
  prometheusOperator:
    enabled: true

    # Operatorê°€ ê´€ë¦¬í•  namespace
    # ì˜µì…˜:
    #   - [] (empty): ëª¨ë“  namespace (ê¸°ë³¸ê°’)
    #   - [monitoring, blog-system]: íŠ¹ì • namespaceë§Œ
    # ê¶Œì¥: ëª¨ë“  namespace (ìœ ì—°ì„±)
    namespaces: {}

    # Admission Webhook ë¹„í™œì„±í™”
    # ì´ìœ : í™ˆë© í™˜ê²½ì—ì„œ ë¶ˆí•„ìš” (webhook ì¸ì¦ì„œ ê´€ë¦¬ ë³µì¡)
    # ì˜í–¥: CRD ìƒì„± ì‹œ validation ì—†ìŒ (YAML ì˜¤ë¥˜ ì£¼ì˜!)
    admissionWebhooks:
      enabled: false

  # ==============================================================================
  # Prometheus
  # ==============================================================================
  # ì—­í• : ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ì €ì¥
  prometheus:
    enabled: true

    # Prometheus ì„¤ì •
    prometheusSpec:
      # ServiceMonitor ì„ íƒ ê·œì¹™ (CRITICAL!)
      # ì¤‘ìš”: ServiceMonitorì— "prometheus: kube-prometheus" ë¼ë²¨ í•„ìˆ˜!
      # ì´ìœ : Helm Chartì˜ ì›ë˜ í‘œì¤€ (Upstream Convention)
      # Platform Conformity: í”Œë«í¼ì´ ì •í•œ í‘œì¤€ ë¼ë²¨ë§ ê·œì¹™ì„ ë”°ë¦„
      # ì˜ˆì‹œ:
      #   apiVersion: monitoring.coreos.com/v1
      #   kind: ServiceMonitor
      #   metadata:
      #     labels:
      #       prometheus: kube-prometheus  â† í•„ìˆ˜! (Helm Chart ê¸°ë³¸ê°’)
      serviceMonitorSelector:
        matchLabels:
          prometheus: kube-prometheus

      # PrometheusRule ì„ íƒ ê·œì¹™ (CRITICAL!)
      # ì¤‘ìš”: PrometheusRuleì—ë„ "prometheus: kube-prometheus" ë¼ë²¨ í•„ìˆ˜!
      ruleSelector:
        matchLabels:
          prometheus: kube-prometheus

      # Probe ì„ íƒ ê·œì¹™ (CRITICAL!)
      # ì¤‘ìš”: Probeì—ë„ "prometheus: kube-prometheus" ë¼ë²¨ í•„ìˆ˜!
      # ì´ìœ : Helm Chartì˜ ì›ë˜ í‘œì¤€ (Upstream Convention)
      # Platform Conformity: í”Œë«í¼ì´ ì •í•œ í‘œì¤€ ë¼ë²¨ë§ ê·œì¹™ì„ ë”°ë¦„
      # ê¸°ë³¸ê°’: probeSelectorNilUsesHelmValues=trueë¡œ ì¸í•´ release: ë¼ë²¨ ì‚¬ìš©
      # ë³€ê²½: prometheus: kube-prometheus (Upstream í‘œì¤€ ëª…ì‹œ)
      # ì˜ˆì‹œ:
      #   apiVersion: monitoring.coreos.com/v1
      #   kind: Probe
      #   metadata:
      #     labels:
      #       prometheus: kube-prometheus  â† í•„ìˆ˜! (Helm Chart ê¶Œì¥ í‘œì¤€)
      probeSelector:
        matchLabels:
          prometheus: kube-prometheus

      # ë©”íŠ¸ë¦­ ë³´ê´€ ê¸°ê°„
      # í˜•ì‹: Nd (Nì¼), Nh (Nì‹œê°„)
      # ê¶Œì¥: 7d (1ì£¼ì¼) - í™ˆë© í™˜ê²½
      # ë³€ê²½ ì‹œ: ë””ìŠ¤í¬ ê³µê°„ ê³ ë ¤ (7d â†’ 30dë©´ 4ë°° ì¦ê°€)
      retention: 7d

      # ë©”íŠ¸ë¦­ ì¿¼ë¦¬ ì‹œê°„ ì œí•œ
      # ì´ìœ : ë³µì¡í•œ PromQL ì¿¼ë¦¬ë¡œ ì¸í•œ OOM ë°©ì§€
      # ê¶Œì¥: 10m (10ë¶„)
      retentionSize: ""

      # Storage ì„¤ì • (PVC)
      # ì´ìœ : Pod ì¬ì‹œì‘ ì‹œ ë©”íŠ¸ë¦­ ë³´ì¡´
      # ì£¼ì˜: StorageClassê°€ ì—†ìœ¼ë©´ Pending ìƒíƒœ
      storageSpec:
        volumeClaimTemplate:
          spec:
            # StorageClass ì§€ì • (ì„ íƒ ì‚¬í•­)
            # ì˜µì…˜: í•„ë“œ ìƒëµ (ê¸°ë³¸ SC ìë™ ì‚¬ìš©), longhorn, nfs-client ë“±
            # ê¶Œì¥: í•„ë“œ ìƒëµ (cluster ê¸°ë³¸ SC ì‚¬ìš©)
            # í˜„ì¬: longhorn (default) ìë™ ì‚¬ìš©

            # ì•¡ì„¸ìŠ¤ ëª¨ë“œ
            # ReadWriteOnce: ë‹¨ì¼ Nodeë§Œ ë§ˆìš´íŠ¸ (ê¶Œì¥)
            # ReadWriteMany: ì—¬ëŸ¬ Node ë§ˆìš´íŠ¸ (NFS í•„ìš”)
            accessModes:
              - ReadWriteOnce

            # ìŠ¤í† ë¦¬ì§€ ìš©ëŸ‰
            # ê³„ì‚°: ì•½ 1GB/day (ê¸°ë³¸ scrape_interval: 30s)
            # 7d retention â†’ 7GB + ì—¬ìœ ë¶„ = 20GB ê¶Œì¥
            resources:
              requests:
                storage: 20Gi

      # ë¦¬ì†ŒìŠ¤ ì œí•œ
      # ì´ìœ : OOM Killer ë°©ì§€, ë‹¤ë¥¸ Pod ì˜í–¥ ìµœì†Œí™”
      # ê¶Œì¥: í™ˆë© í™˜ê²½ ê¸°ì¤€
      resources:
        requests:
          cpu: 500m      # ìµœì†Œ 0.5 core
          memory: 2Gi    # ìµœì†Œ 2GB RAM
        limits:
          cpu: 2000m     # ìµœëŒ€ 2 cores
          memory: 4Gi    # ìµœëŒ€ 4GB RAM

  # ==============================================================================
  # Grafana
  # ==============================================================================
  # ì—­í• : ë©”íŠ¸ë¦­ ì‹œê°í™” ëŒ€ì‹œë³´ë“œ
  grafana:
    enabled: true

    # Admin ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½ ê¶Œì¥!)
    # ì£¼ì˜: í‰ë¬¸ ì €ì¥ (SealedSecretìœ¼ë¡œ ê´€ë¦¬ ê¶Œì¥)
    # TODO: grafana-admin-sealedsecret.yamlë¡œ êµì²´
    adminPassword: admin

    # Sidecar ì„¤ì • (ìë™ Dashboard ë¡œë“œ)
    # ì‘ë™ ì›ë¦¬:
    #   1. ConfigMapì— "grafana_dashboard: \"1\"" ë¼ë²¨ ì¶”ê°€
    #   2. Sidecarê°€ ìë™ ê°ì§€í•˜ì—¬ Grafanaì— ë¡œë“œ
    #   3. ConfigMap ìˆ˜ì • â†’ ìë™ reload (ìˆ˜ë™ import ë¶ˆí•„ìš”!)
    sidecar:
      dashboards:
        enabled: true

        # Dashboard ìë™ ë¡œë“œ ë¼ë²¨
        # ì¤‘ìš”: ConfigMapì— ì´ ë¼ë²¨ í•„ìˆ˜!
        # ì˜ˆì‹œ:
        #   apiVersion: v1
        #   kind: ConfigMap
        #   metadata:
        #     labels:
        #       grafana_dashboard: "1"  â† í•„ìˆ˜!
        label: grafana_dashboard

        # ë¼ë²¨ ê°’ (ê¸°ë³¸: "1")
        # ì˜µì…˜: "1", "true", "enabled" ë“± (ë¬¸ìì—´ í•„ìˆ˜!)
        labelValue: "1"

        # ê²€ìƒ‰í•  namespace
        # ì˜µì…˜:
        #   - null: ëª¨ë“  namespace (ê¸°ë³¸ê°’)
        #   - monitoring: monitoring namespaceë§Œ
        # ê¶Œì¥: null (ìœ ì—°ì„±)
        searchNamespace: null

      # Datasource ìë™ ë¡œë“œ (ì„ íƒ ì‚¬í•­)
      # ì´ìœ : PrometheusëŠ” ì´ë¯¸ ìë™ ë“±ë¡ë¨
      datasources:
        enabled: true

    # Persistent Storage (ì„ íƒ ì‚¬í•­)
    # ì´ìœ : Dashboard ì„¤ì • ë³´ì¡´ (Sidecar ì‚¬ìš© ì‹œ ë¶ˆí•„ìš”)
    # ê¶Œì¥: ë¹„í™œì„±í™” (ConfigMapìœ¼ë¡œ ê´€ë¦¬)
    persistence:
      enabled: false

  # ==============================================================================
  # AlertManager
  # ==============================================================================
  # ì—­í• : Alert ì•Œë¦¼ ì „ì†¡ (Telegram, Slack, Email ë“±)
  alertmanager:
    enabled: true

    # AlertManager ì„¤ì •
    alertmanagerSpec:
      # Storage ì„¤ì • (ì„ íƒ ì‚¬í•­)
      # ì´ìœ : Alert ì´ë ¥ ë³´ì¡´ (Silences, Inhibit Rules)
      # ê¶Œì¥: í™ˆë© í™˜ê²½ì—ì„œëŠ” ë¹„í™œì„±í™” (íœ˜ë°œì„± ë°ì´í„°)
      storage: {}

      # ë¦¬ì†ŒìŠ¤ ì œí•œ
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 200m
          memory: 256Mi

  # ==============================================================================
  # Exporters (Node Exporter, Kube-State-Metrics)
  # ==============================================================================

  # Node Exporter ë¹„í™œì„±í™”
  # ì´ìœ : Grafana Alloyë¡œ ì´ë¯¸ Node ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì¤‘
  # ì˜í–¥: ì¤‘ë³µ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë°©ì§€
  nodeExporter:
    enabled: false

  # Kube-State-Metrics í™œì„±í™”
  # ì—­í• : Kubernetes ë¦¬ì†ŒìŠ¤ ìƒíƒœ ë©”íŠ¸ë¦­ (Deployment, Pod, Node ë“±)
  # í•„ìˆ˜: Kubernetes í´ëŸ¬ìŠ¤í„° ëª¨ë‹ˆí„°ë§ì— í•„ìˆ˜
  kubeStateMetrics:
    enabled: true

  # ==============================================================================
  # Default Rules (Alert Rules)
  # ==============================================================================
  # ì´ìœ : Upstream ê¸°ë³¸ Alert Rules í¬í•¨ (Node, Pod, etcd ë“±)
  # ì˜µì…˜:
  #   - true: ê¸°ë³¸ Rules ì‚¬ìš© (ê¶Œì¥ - í•™ìŠµìš©)
  #   - false: ì»¤ìŠ¤í…€ PrometheusRuleë§Œ ì‚¬ìš©
  # ê¶Œì¥: true (ë‚˜ì¤‘ì— falseë¡œ ë³€ê²½ ê°€ëŠ¥)
  defaultRules:
    create: true

    # ê¸°ë³¸ Rules ë¼ë²¨
    # ì´ìœ : Prometheusê°€ Rulesë¥¼ ì¸ì‹í•˜ë ¤ë©´ ë¼ë²¨ í•„ìš”
    rules:
      alertmanager: true
      etcd: true
      general: true
      k8s: true
      kubeApiserver: true
      kubePrometheusNodeRecording: true
      kubernetesSystem: true
      node: true
      prometheus: true

# ==============================================================================
# ì£¼ì˜ì‚¬í•­ ë° ë‹¤ìŒ ë‹¨ê³„
# ==============================================================================
# âš ï¸ ì£¼ì˜ì‚¬í•­:
#   1. ServiceMonitor/PrometheusRuleì— "prometheus: kube-prometheus" ë¼ë²¨ í•„ìˆ˜!
#   2. Grafana Dashboard ConfigMapì— "grafana_dashboard: \"1\"" ë¼ë²¨ í•„ìˆ˜!
#   3. adminPasswordëŠ” SealedSecretìœ¼ë¡œ êµì²´ ê¶Œì¥
#
# ğŸ“ ë‹¤ìŒ ë‹¨ê³„:
#   1. ServiceMonitor ìƒì„± (configs/monitoring/servicemonitors/)
#   2. PrometheusRule ìƒì„± (configs/monitoring/prometheusrules/)
#   3. Grafana Dashboard ConfigMap ë¼ë²¨ ì¶”ê°€
#   4. ArgoCD Application ìƒì„± (argocd/kube-prometheus-stack-app.yaml)
#   5. ê¸°ì¡´ Raw ConfigMap ì œê±° (prometheus-config.yaml, prometheus-alert-rules.yaml)
#
# ğŸ” ê²€ì¦ ëª…ë ¹ì–´:
#   # Operator Pod í™•ì¸
#   kubectl get pods -n monitoring -l app.kubernetes.io/name=prometheus-operator
#
#   # ServiceMonitor ì¸ì‹ í™•ì¸
#   kubectl get servicemonitor -n monitoring
#
#   # PrometheusRule ì¸ì‹ í™•ì¸
#   kubectl get prometheusrule -n monitoring
#
#   # Prometheus ì„¤ì • í™•ì¸ (ìë™ ìƒì„±ëœ prometheus.yml)
#   kubectl exec -n monitoring prometheus-kube-prometheus-stack-prometheus-0 \
#     -- cat /etc/prometheus/config_out/prometheus.env.yaml
# ==============================================================================
